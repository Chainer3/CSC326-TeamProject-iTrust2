<html xmlns:th="http://www.thymeleaf.org">
<head th:include="layout :: head(title=~{::title},links=~{})">
<title>All Patient Bills</title>
</head>
<body th:include="layout :: body" th:with="content=~{::content}">

	<div th:fragment="content">
		<script th:inline="javascript">
            var app = angular.module('billsApp', []);
            angular.module("billsApp").controller('billsCtrl', function ($scope, $http, $window) {
            	//All bills
            	$scope.bills = [];
            	//All of the patient's bills
            	$scope.patientBills = [];
            	
            	//Updates the table with the most current data
            	$scope.updateTable = function() {
                    $http.get("/iTrust2/api/v1/bills/").then(
                    		function(response) {
                                $scope.bills = response.data;
                                $scope.message = "";
                                $scope.queryMode = true;
                                $scope.viewMode = false;
                    		}, function(rejection) {
                    			$scope.bills = [];
                    			$scope.bills = "Could not display CPT Codes";
                            });
            	}
            	
            	//View a specific bill in a changed view
                $scope.viewBill = function(bill) {
                    $scope.queryMode = false;
                    $scope.viewMode = true;
                    
                    $scope.populateBill(bill);
            	}
            	
            	//Search for a patient by username
            	$scope.searchPatient = function(patientUsername) {
                    $http.get("/api/v1/patients/" + patientUsername + "/bills").then(
                    		function(response) {
                                $scope.bills = response.data;
                                $scope.message = "";
                                $scope.queryMode = true;
                                $scope.viewMode = false;
                    		}, function(rejection) {
                    			$scope.bills = [];
                    			$scope.bills = "Could not find patient";
                            });
            	}
                
                //Populates the Bill's data in the form
                $scope.populateBill = function(bill) {
				    $scope.bill = {};
				    $scope.bill.id = bill.id;
				    $scope.bill.visit.patient.username = bill.visit.patient.username;
				    $scope.bill.visit.date = bill.visit.date;
				    $scope.bill.isPaid = bill.isPaid;
				    $scope.bill.totalDue = bill.totalDue;
				    $scope.bill.visit.cptCodes = bill.visit.cptCodes;
			    }
            	

            });      
            
        </script>
        
		<div ng-app="billsApp" ng-controller="billsCtrl as ctrl">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<div class="panel panel-primary">

							<!-- active cpt's header -->
							<div class="panel-heading">
								<h3>Patient Bills</h3>
							</div>
							<div class="panel-body">
								<table class="table table-bordered" name="cpt_table">

									<!-- table column headers -->
									<thead>
										<tr>
											<th>Patient Username</th>
											<th>Date of Visit</th>
											<th>Status</th>
											<th>Amount Due</th>
											<th>Action</th>
										</tr>
									</thead>

									<!-- CPT code for every row, ordered by code ascending -->
									<tbody>
										<tr name="cptTableRow" ng-repeat="l in cpts | orderBy: 'code'"
											codeId={{l.id}}>
											<td name="usernameCell">{{l.visit.patient.username}}</td>
											<td name="visitDateCell">{{l.visit.date}}</td>
											<td name="statusCell">{{l.isPaid}}</td>
											<td name="dueCell">{{l.totalDue}}</td>
											<td name="actionCell"><input type="button" 
											    ng-click="viewBill(l)" value="View" /></input></td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>	
	</div>
</body>
</html>



<input type="checkbox" ng-model="checked" aria-label="Toggle ngShow"><br />
<div class="check-element animate-show-hide" ng-show="checked">
  I show up when your checkbox is checked.
</div>